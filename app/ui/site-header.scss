@use "~/styles/system/media";
@use "~/styles/system/color" as color;

$small_menu_breakpoint: media.get(sm);

:root {
	--ui-site-header-height: 4.5rem;
	@media (--sm) {
		--ui-site-header-height: 6rem;
	}
}

:where(*) {
	scroll-margin-top: calc(var(--ui-site-header-height) + 0.5rem);
}

.cs--site-header {
	$self: &;
	--transition-duration: 200ms;
	--transition-func: ease-out;
	--header-bg-opacity: 0.6;
	--header-bg-color: hsl(180deg 8% 100% / var(--header-bg-opacity));
	--header-height: var(--ui-site-header-height);
	--header-logo-size: 3.5rem;
	--header-border-size: 1px;
	height: var(--header-height);
	@media (--sm) {
		--header-logo-size: 4rem;
		--header-border-size: 0;
	}
	@media (--dark) {
		--header-bg-color: hsl(0deg 0% 0% / var(--header-bg-opacity));
	}

	width: 100%;
	background-color: transparent;
	transition: background-color var(--transition-duration) var(--transition-func),
		color var(--transition-duration) var(--transition-func);
	border-bottom: var(--header-border-size) solid var(--cs-color-border-weak);

	& > * {
		position: relative;
	}

	&:where([data-ui-position="default"]) {
		position: relative;
	}

	&:where([data-ui-position="sticky"]),
	&:where([data-ui-position="fixed"]),
	&:where([data-ui-position="absolute"]) {
		top: 0;
		z-index: 10;
	}

	&:where([data-ui-position="sticky"]) {
		position: sticky;
	}

	&:where([data-ui-position="fixed"]) {
		position: fixed;
	}

	&:where([data-ui-position="absolute"]) {
		position: absolute;
	}

	:where([data-hydrated]) & {
		--transition-duration: 200ms;
		--transition-func: ease-out;
		transition: filter var(--transition-duration) var(--transition-func),
			background-color var(--transition-duration) var(--transition-func),
			color var(--transition-duration) var(--transition-func);

		&::before {
			content: "";
			position: absolute;
			inset: 0;
			transition: inherit;
			background-color: var(--header-bg-color);
			backdrop-filter: blur(20px);
		}

		@media screen and (#{$small_menu_breakpoint}) {
			&::before {
				background-color: transparent;
				backdrop-filter: blur(0);
			}

			&:where([data-ui-is-past-scroll-threshold="true"])::before {
				background-color: var(--header-bg-color);
				backdrop-filter: blur(20px);
			}
		}
	}

	@media screen and (#{$small_menu_breakpoint}) {
		&:where([data-ui-is-past-scroll-threshold="true"]) {
			background-color: var(--cs-color-background-translucent);
		}

		&:where([data-ui-is-past-scroll-threshold="false"], :not([data-ui-is-past-scroll-threshold])) {
			background-color: transparent;
			border-color: transparent;
		}
	}

	&:where([data-ui-has-bottom-margin]) {
		margin-bottom: var(--cs-space-xl);
	}

	@media (--sm) {
		&:where([data-ui-has-bottom-margin]) {
			margin-bottom: calc(var(--cs-space-md) * 3.5);
		}
	}

	@media (--md) {
		&:where([data-ui-has-bottom-margin]) {
			margin-bottom: var(--cs-space-xxl);
		}
	}

	&__inner {
		position: relative;
		display: flex;
		align-items: center;
		justify-content: space-between;
		height: var(--header-height);
	}

	&__nav-list {
		display: none;
		font-weight: var(--cs-font-weight-strongest);
		text-transform: uppercase;
		gap: 1em;
		@media screen and (#{$small_menu_breakpoint}) {
			display: flex;
		}
	}

	&__nav-link {
		color: var(--cs-color-text);

		&:hover {
			color: var(--cs-color-text-link-hover);
		}
	}

	&__nav-dialog-overlay {
		--dialog-overlay-bg-opacity: 0.4;
		position: fixed;
		inset: 0;

		@media (--dark) {
			--dialog-overlay-bg-opacity: 0.8;
		}

		@media screen and (#{$small_menu_breakpoint}) {
			display: none;
		}
	}

	&__nav-dialog-overlay-inner {
		height: calc(100% - var(--ui-site-header-height, 0));
		width: 100%;
		margin-top: var(--ui-site-header-height, 0);
		background-color: rgb(0 0 0 / var(--dialog-overlay-bg-opacity));
		backdrop-filter: blur(4px);
	}

	&__nav-toggle {
		display: flex;
		align-items: center;
		justify-content: center;
		width: 2rem;
		height: 2rem;
		border: 1px solid var(--cs-color-border-weak);
		@media screen and (#{$small_menu_breakpoint}) {
			display: none;
		}
	}

	&__nav-toggle-icon {
		display: block;
		height: 1px;
		width: 1rem;
		background-color: currentColor;
		position: relative;

		&::before,
		&::after {
			content: "";
			display: block;
			height: inherit;
			width: inherit;
			background-color: inherit;
			position: absolute;
		}

		&::before {
			top: -0.375rem;
		}

		&::after {
			top: 0.375rem;
		}
	}

	&__nav-dialog {
		position: absolute;
		right: 0;
		top: 0;
		background-color: var(--cs-color-background);
		width: 100%;
		:where(#{$self}__nav-list) {
			display: flex;
			flex-direction: column;
		}

		:where(#{$self}__nav-item) {
			width: 100%;
		}

		:where(#{$self}__nav-link) {
			display: flex;
			width: 100%;
		}
	}

	&__nav-dialog-inner {
		overflow-x: hidden;
		overflow-y: auto;
		padding: 1rem;
	}

	&__logo-link {
		display: flex;
		place-content: center;
		color: var(--cs-color-text);
		position: absolute;
		top: 50%;
		left: 50%;
		transform: translate(-50%, -50%);
		border-radius: 9999px;
		outline-offset: 2px;
		@media (#{$small_menu_breakpoint}) {
			position: relative;
			top: initial;
			left: initial;
			transform: initial;
		}
	}

	&__logo {
		fill: currentColor;
		width: var(--header-logo-size);
		height: var(--header-logo-size);
	}

	&__logo-text {
		transition-property: fill, stroke, opacity;
		transition-timing-function: ease-out;
		transition-duration: 150ms;
		transform-origin: center;
		opacity: 0;
		:where(#{$self}__logo-link:hover, #{$self}__logo-link:focus) & {
			opacity: 1;
		}
		@media (#{$small_menu_breakpoint}) {
			opacity: 1;
		}
	}

	&__logo-mark {
		transition-property: color, background-color, border-color,
			text-decoration-color, fill, stroke;
		transition-timing-function: ease-out;
		transition-duration: 150ms;

		:where(a:hover) & {
			fill: var(--cs-color-accent);
		}
	}
}
